# Remotely Operated Underwater Vehicle
![9401e3b7-abda-4b59-9359-4a82c22e7b2f](https://github.com/MohammadAmmargk8497/ROV1.0/assets/75717701/faa7e680-f711-4787-b866-4df94a74adfb)
This is the major project of students of ZHCET, AMU under the aegis of MTS AUV ZHCET Club. This repository is an effort to design the first generation of software for Remotely Operated Underwater Vehicle. The software system can be broken down into two major parts; 1). The Vehicle Side and 2). The Base Station Side.


<img width="264" alt="Screenshot 2024-04-16 at 7 59 18â€¯PM" src="https://github.com/MohammadAmmargk8497/ROV1.0/assets/75717701/a402932e-34b4-4920-8b0e-1af140b6fd58">

1. **The Vehicle Side:**
   The vehicle side of the program is simple, it does two tasks: generate controls for the thrusters and send feedback data ( camera-feed and generated control values) to be displayed back to BS. It contains the following:
   

   * **control.py** : This file employs Multithreading in a producer-consumer fashion; here the *GUI* function is the consumer thread and *run*
                  function as the producer thread. The run function generates the control and pushes their values on the queue. The thread-                    safe queue is then accessed by the GUI function which encodes and transmit the data back to BS using UDP protocol.

   
    ![IMG_1478](https://github.com/MohammadAmmargk8497/ROV1.0/assets/75717701/2c0aec0d-6ce6-47bf-928b-acbea3391c0b)


     
   * **cam_vehicle.py**: This script uses opencv to capture video frames and send them over to the base station using udp protocol.

2. **The Base Station Side:**
    The Base Station contains two scripts; *joystickrender.py* and *opencvserver.py*.
   * **joystickrender.py**: This is responsible for displaying the realtime PWM values being generated by the control.py. Future work is needed to transform this into a complete interface.
   *  **opencvserver.py**: This is responsible for rendering the camera stream generated and sended by the cam_vehicle.py. Work is needed to integrate this and joystickrender.py into a single file named UIX.py containing all the necessary data and feeds. 


# Getting Started


## On the server side(linux):

1. ```sudo apt-get install linux-tools-generic``` 

2. ```sudo modprobe usbip_host```

3. ```sudo nano /etc/modules```

4. add ```usbip_host``` to the end of texts
5. ```sudo ufw allow 7777``` Allowing Firewall for Joystick
6. ```sudo ufw allow 6666``` Allowing Firewall for OpenCV server

7. ```lsusb``` to see a list of attached USB devices

8. ```sudo usbip list -p -l``` Check the busid of the Controller

9. ```sudo usbip bind --busid="Bus ID"``` enter busid of the controller

10. ```sudo usbipd``` to start Daemon.
    #### Commands 7-10 has to be run everytime.

## On the client side(rpi):
### Make sure that the Raspberry PI is on bullseye version.
1. Make sure that the date and time on Pi is correct. If not change with ```sudo date -s "YYYY-MM-DD HH:MM:SS"```

2. ```sudo apt update``` 

3. On RaspberryPi before using Pip first do 
  ```sudo rm /usr/lib/python3.11/EXTERNALLY-MANAGED```
  if nothing is deleted then ignore this line.

4. ```sudo apt install usbip```

5. ```sudo modprobe vhci-hcd```

6. ```sudo nano /etc/modules```

7. add ```vhci-hcd``` to the end of texts
8. Install OpenCV in PI.

9. ```sudo usbip attach -r "IP Address" -b "Bus ID"```

10. Run ```sudo pigpiod``` on Terminal.
   
11. ```python3 control.py```
12. ```python3 cam_vehicle.py```
    
    #### Commands 1, 9-12 has to be run everytime